<div [ngClass]="{nightbg: isNight, daybg: !isNight}">

  <ng-template #gameOver>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">Game Over</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {{endResult}}
      </div>
      <div class="modal-footer">
        <button id="roleready" type="button" class="btn btn-success" (click)="modalRef.hide()">OK!</button>
      </div>
    </div>
  </ng-template>

  <ng-template #runSheriffOrNot>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">è­¦é•¿ç«é€‰(Run Sheriff)ğŸš”</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendReady()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ä½ è¦ç«é€‰è­¦é•¿å—ï¼Ÿ(Do you want to run the Sheriff?)
      </div>
      <div class="modal-footer">
        <button id="roleready" type="button" class="btn btn-success" (click)="sendVote(user.name)">è¦!</button>
        <button type="button" class="btn btn-secondary" (click)="sendReady()">ä¸è¦</button>
      </div>
    </div>
  </ng-template>

  <ng-template #passBadgeOrNot>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">è­¦å¾½(badge)ğŸš”</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendReady()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ä½ æ­»äº†ï¼Œè¦ä¼ é€’è­¦å¾½å—ï¼Ÿ(You are dead, pass the sheriff badge?)
        <div>
          <button type="button" class="btn btn-outline-primary m-3" *ngFor="let user of game.users"
            (click)="sendVote(user.name)">
            {{user.name}}
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="sendReady()">ä¸è¦(No)</button>
      </div>
    </div>
  </ng-template>


  <ng-template #userRole>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">ä½ çš„èº«ä»½(Your role)</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendStart()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h5>{{sio.roleLabel[user.role]}}({{user.role}})</h5>
      </div>
      <div class="modal-footer">
        <button id="roleready" type="button" class="btn btn-success" (click)="sendStart()">è®°ä½å•¦ï¼Œå¼€å§‹å§ (Let's GO!)</button>
      </div>
    </div>
  </ng-template>

  <ng-template #saveOrNot>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">è§£è¯ğŸ˜‡</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendReady()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="user.antidote && user.alive && user.name !== user.lastAttacked">{{user.lastAttacked}} è¢«å’¬äº†ï¼Œæ•‘å—ï¼Ÿ(Use
          antidote?)</div>
        <div *ngIf="!user.antidote">æ²¡æœ‰è§£è¯äº†(No more antidote)</div>
        <div *ngIf="user.name === user.lastAttacked">ä¸èƒ½æ•‘è‡ªå·±(Cannot save self)</div>
      </div>
      <div class="modal-footer">
        <button *ngIf="user.antidote && user.alive && user.name !== user.lastAttacked" id="roleready" type="button"
          class="btn btn-success" (click)="sendVote(user.lastAttacked)">æ•‘(Save)
        </button>
        <button type="button" class="btn btn-secondary" (click)="sendReady()">ç®—äº†(Forget it)</button>
      </div>
    </div>
  </ng-template>

  <ng-template #poisonOrNot>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">æ¯’è¯ğŸ¤®</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendReady()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="user.poison && user.alive">
          <h3>è¦æ¯’è°å—ï¼Ÿ(Poison?)</h3>
          <div>
            <button type="button" class="btn btn-outline-primary m-3" *ngFor="let u of game.users"
              (click)="sendVote(u.name)" [disabled]="!u.alive || u.name == user.name">
              {{u.name}}
            </button>
          </div>
        </div>
        <div *ngIf="!user.poison || !user.alive">
          <h3>æ²¡æ³•ä¸‹æ¯’äº†(No way to poison)</h3>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="sendReady()">ç®—äº†(Forget it)</button>
      </div>
    </div>
  </ng-template>

  <ng-template #revengeOrNot>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">çŒäººå¼€æªğŸ”«</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendReady()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ä½ æ­»äº†è¦å¼€æªå¸¦èµ°è°å—ï¼Ÿ(You are dead. Do you want to kill someone?)
        <div>
          <button type="button" class="btn btn-outline-primary m-3" *ngFor="let u of game.users"
            (click)="sendVote(u.name)" [disabled]="!u.alive || u.name == user.name">
            {{u.name}}
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="sendReady()">ä¸å¼€æª(No)</button>
      </div>
    </div>
  </ng-template>
  <ng-template #hunterOk>
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title pull-left">çŒäººå¼€æªğŸ”«</h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="sendReady()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ä½ ä¸èƒ½å¼€æª(You cannot shoot now)
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="sendReady()">å¥½å§(Alright)</button>
      </div>
    </div>
  </ng-template>

  <div *ngIf="game">


    <div *ngIf="user" class="nav my-2 p-0 d-flex justify-content-between align-items-center"
      [ngClass]="{'text-white': isNight, 'bg-dark': isNight, 'text-dark': !isNight, 'bg-light': !isNight}">
      <button type="button" id="myrole" class="btn btn-primary nav-item" (click)="openModal('userRole')">æˆ‘çš„èº«ä»½</button>
      <div class="text-center nav-item">
        <span *ngIf="isNight">ğŸŒœ</span>
        <span *ngIf="!isNight">ğŸ˜</span>
        {{game.round}} - {{sio.stateLabel[currentState]}}({{currentState}})
      </div>
      <div class="nav-item">
        <button *ngIf="user.isOrganizer" type="button" id="restart" class="btn btn-warning"
          (click)="restartGame()">ä»æ¥(Restart)</button>
        <button type="button" id="mute" class="btn btn-info" (click)="toggleMute()">
          <span *ngIf="mute">ğŸ”ˆ</span><span *ngIf="!mute">ğŸ”‡</span>
        </button>
      </div>

    </div>

    <div *ngIf="user" class="alert" [ngClass]="{'alert-danger': !user.alive, 'alert-success': user.alive}">
      {{user.name}} - {{user.role}}

      <span *ngIf="user.alive"> ğŸ˜€ </span>
      <span *ngIf="!user.alive"> ğŸ˜µ </span>
      <span *ngIf="user.sheriff"> ğŸš” </span>

      {{currentRound}}-{{sio.stateLabel[currentState]}}
    </div>

    <div *ngIf="this.currentState == 'roleCheck' && !this.sio.gameStatus.readySent" class="alert alert-primary"
      (click)="openModal('userRole')">
      è¯·æ£€æŸ¥ä½ çš„èº«ä»½ Please check your role
    </div>
    <div *ngIf="this.currentState !== 'roleCheck' || this.sio.gameStatus.readySent" class="row m-3">
      <div class="col-6 p-1" *ngFor="let user of game.users" (click)="sendVote(user.name)">
        <div class="card shadow"
          [ngClass]="{'text-white': isNight, 'bg-dark': isNight, 'text-dark': !isNight, 'bg-light': !isNight}">
          <div class="row no-gutters">
            <div class="col-4">
              <img *ngIf="user.alive" [src]="user.avatar + '.svg'" class="card-img">
              <img *ngIf="!user.alive" [src]="user.avatar + '-dead.svg'" class="card-img">
            </div>
            <div class="col-8">
              <div class="card-body">
                {{user.name}}
                <span *ngIf="user.isOrganizer">ğŸš¦</span>
                <span *ngIf="user.sheriffRunning">âœ‹</span>
                <span *ngIf="user.sheriff">ğŸš”</span>
                <span *ngIf="!user.alive">ğŸ˜µ</span>
                <span *ngIf="user.selected">âœ…</span>
                <!-- <button type="button" class="btn btn-outline-primary" (click)="sendVote(user.name)">Select</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="messages.length" class="notification-footer">
      <div *ngFor="let message of messages" class="alert"
        [ngClass]="{'alert-info':message.level == 'info', 'alert-warning': message.level == 'warning', 'alert-danger': message.level == 'danger'}"
        @messageInOutTrigger>
        {{message.message}}
        <button type="button" class="close pull-right" aria-label="Close" (click)="dismissMessage(message.id)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>

    <app-action-menu [actions]="actionButtons">

    </app-action-menu>
  </div>

</div>